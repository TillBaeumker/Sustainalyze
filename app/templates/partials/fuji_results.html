{% if result.fair_mode == "fuji" and result.fuji_all %}
<section class="page-block">
  <h4 id="toc-fuji-external">ðŸ§ª FUJI FAIRNESS â€“ Externe DatensÃ¤tze</h4>

  {% for ds in result.fuji_all %}
    {% set summary = ds.fuji_summary or {} %}
    {% set score = summary.get("fair_score", "â€“") %}
    {% set maturity = summary.get("maturity", "â€“") %}
    {% set metrics = summary.get("metrics_labeled", []) %}

    <details class="fuji-entry">
      <summary class="fuji-summary">
        <span class="fuji-summary-title">
          potenzieller Datensatz:
          <a href="{{ ds.url }}" target="_blank">{{ ds.url }}</a>
        </span>
      </summary>

      <!-- Fundstelle -->
      {% if ds.page_url %}
      <div class="fuji-found-on">
        <strong>Gefunden auf:</strong><br>
        <a href="{{ ds.page_url }}" target="_blank">{{ ds.page_url }}</a>
      </div>
      {% endif %}

      <!-- FAIR SUMMARY -->
      <div class="fuji-score-block">
        <div><strong>FAIR-Score:</strong> {{ score }}</div>
        <div><strong>Reifegrad:</strong> {{ maturity }}</div>
      </div>

      <!-- Metriken -->
      <details class="fuji-metrics">
        <summary>Metriken</summary>

        {% if metrics %}
        <ul>
          {% for m in metrics %}
          <li>
            {{ m.get("label") }} ({{ m.get("code") }}):
            {{ m.get("score", "â€“") }}
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p>Keine Metriken vorhanden.</p>
        {% endif %}
      </details>

      <!-- RAW JSON -->
      {% if ds.raw_fuji_json %}
      <details class="fuji-raw">
        <summary>RAW FUJI JSON</summary>
        <pre>{{ ds.raw_fuji_json | tojson(indent=2) }}</pre>
      </details>
      {% endif %}

    </details>
  {% endfor %}

</section>
{% endif %}
