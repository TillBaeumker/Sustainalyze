<section id="report">

  <!-- HEADER -->
  <header class="report-header">
    <h2 id="toc-report" class="report-title">Analyse: {{ report.project_name|e }}</h2>

    {% set total_score = report.total.score if report.total.score is not none else 0 %}
    {% set total_band  = report.total.band if report.total.band is not none else 'â€“' %}

    <div class="report-meta">
      <span class="badge">ğŸ“„ <strong>{{ report.valid_pages }}</strong> Seite(n)</span>

      <span class="badge">ğŸ§® Nachhaltigkeitsscore:
        <strong>{{ total_score }}</strong>
        Â· Bewertung: {{ total_band }}
      </span>

      <span class="badge">ğŸŒ Hosting:
        <strong>{{ report.hosting_country|e if report.hosting_country else 'â€“' }}</strong>
        ({{ report.hosting_org|e if report.hosting_org else 'â€“' }})
      </span>
    </div>

    <div class="report-scorebar" style="--score: {{ total_score }}">
      <div class="score-line">
        <span>Digitaler Nachhaltigkeitsscore</span>
        <span>
          {% if report.total.score is not none %}
            {{ report.total.score }}
          {% else %}
            nicht bewertbar
          {% endif %}
        </span>
      </div>

      <div class="scorebar"></div>

      <!-- Hinweis -->
      <p class="score-note">
        Hinweis: Der Score basiert auf den gecrawlten Seiten und den dort gefundenen Evidenzen.
      </p>

      <!-- Nachhaltigkeits-EinschÃ¤tzung -->
      {% if total_score >= 75 %}
        <p class="score-note" style="margin-top: 0.6rem;">
          ğŸŒ¿ Der gecrawlte Ausschnitt zeigt deutliche Indizien einer nachhaltigen Editionspraxis.
        </p>
      {% elif total_score >= 50 %}
        <p class="score-note" style="margin-top: 0.6rem;">
          ğŸŒ± Der gecrawlte Ausschnitt weist mehrere Hinweise auf nachhaltige Editionsmerkmale auf.
        </p>
      {% elif total_score >= 25 %}
        <p class="score-note" style="margin-top: 0.6rem;">
          âš ï¸ Der gecrawlte Ausschnitt zeigt nur wenige Hinweise auf nachhaltige Editionsmerkmale.
        </p>
      {% else %}
        <p class="score-note" style="margin-top: 0.6rem;">
          â— Der gecrawlte Ausschnitt enthÃ¤lt kaum oder keine Hinweise auf nachhaltige Editionspraxis.
        </p>
      {% endif %}
    </div>
  </header>


  <!-- ZUSAMMENFASSUNG VOR DER TABELLE -->
  <section class="report-section">
    <h3 class="section-title">Zusammenfassung (KI-generiert)</h3>
    <p class="muted">{{ report.conclusion|e if report.conclusion else 'â€“' }}</p>
  </section>


  <!-- TABELLE -->
  <section class="report-table-section">
    <h3 class="section-title">Nachhaltigkeitsanalyse im Detail</h3>

    <div class="table-wrap">
      <table class="report-table">
        <thead>
          <tr>
            <th>Was wurde geprÃ¼ft?</th>
            <th>Ergebnis</th>
            <th>Hinweise & Evidenzen</th>
          </tr>
        </thead>

        <tbody>
          {% for cluster in report.rows %}
            <tr class="cluster-row">
              <td colspan="3">{{ cluster.section }}</td>
            </tr>

            {% for r in cluster["items"] %}
              <tr>
                <td class="label">{{ r.label|e }}</td>
                <td>{{ r.bewertung|e }}</td>
                <td>{{ r.hinweise | safe if r.hinweise else 'â€“' }}</td>
              </tr>
            {% endfor %}
          {% endfor %}
        </tbody>

      </table>
    </div>
  </section>


  <!-- STÃ„RKEN -->
  <section class="report-section">
    <h3 class="section-title">StÃ¤rken</h3>
    <ul class="section-list">
      {% for s in report.strengths %}
        <li>âœ… {{ s|e }}</li>
      {% else %}
        <li class="muted">â€“</li>
      {% endfor %}
    </ul>
  </section>


  <!-- SCHWÃ„CHEN -->
  <section class="report-section">
    <h3 class="section-title">SchwÃ¤chen</h3>
    <ul class="section-list">
      {% for w in report.weaknesses %}
        <li>âš ï¸ {{ w|e }}</li>
      {% else %}
        <li class="muted">â€“</li>
      {% endfor %}
    </ul>
  </section>

</section>
